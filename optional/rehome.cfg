[gcode_macro rehome]
gcode:
    {% set TEST = params.TEST|default(0)|int %}
    {% set COUNT = params.COUNT|default(2)|int %}

    {% set TEMP = params.EXTRUDER|default(0)|float %}

    {% if TEST == 0 %}
        G28 Z
    {% endif %}

    {% if "gcode_macro WIPER_FULL_SERVICE" in printer %}
        RESPOND PREFIX="// REHOME" MSG="{'range: %s' % (range(COUNT))}"

        {% for i in range(COUNT) %}
            RESPOND PREFIX="// REHOME" MSG="{'round no %d, clean and home' % (i)}"
            {% if TEST == 0 %}
                WIPER_FULL_SERVICE WIPE_MOVES=0 {%if TEMP%}TEMP={TEMP}{%endif%}
                G28 Z
            {% endif %}
        {% endfor %}

    {% else %}
        RESPOND PREFIX="// REHOME" MSG="no wiper found"
    {% endif %}
